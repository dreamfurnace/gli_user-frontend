import{j as pe,r as i,c as T,d as me,o as q,Y as ve,k as p,f as z,p as e,q as b,u as n,J as fe,v as m,O as J,G as _e,A as U,L as F,n as C,F as ge,H as ye,z as be,l as v}from"./vue-B2oCC0D2.js";import{p as _,c as he,H as we,L as Pe,R as ke,b as Se,_ as xe}from"./index-CwjfIGrk.js";import"./utils-NIGUFBhG.js";const Te=pe("profileEdit",()=>{const f=i({email:"",name:"",phone:"",profile_image_url:"",account_type:"email",is_phone_verified:!1,subscription_type:"free",subscription_status:"active",role:"user",payment_method_registered:!1,payment_card_number:"",payment_card_type:"",payment_card_expiry:""}),u=i(!1),d=i(null),y=i(null),V=T(()=>(f.value.name?.trim().length??0)>0);async function E(){u.value=!0,d.value=null;try{const a=await _.getProfile();f.value={id:a.data.id,email:a.data.email||"",name:a.data.name||"",phone:a.data.phone||"",profile_image_url:a.data.profile_image_url||"",account_type:a.data.account_type||"email",is_phone_verified:a.data.is_phone_verified||!1,phone_verified_at:a.data.phone_verified_at,subscription_type:a.data.subscription_type||"free",subscription_status:a.data.subscription_status||"active",subscription_start_date:a.data.subscription_start_date,subscription_end_date:a.data.subscription_end_date,role:a.data.role||"user",created_at:a.data.created_at,updated_at:a.data.updated_at,payment_method_registered:a.data.payment_method_registered||!1,payment_card_number:a.data.payment_card_number||"",payment_card_type:a.data.payment_card_type||"",payment_card_expiry:a.data.payment_card_expiry||""}}catch(a){d.value=a.response?.data?.message||a.message||"프로필 정보를 불러오는데 실패했습니다."}finally{u.value=!1}}async function L(){if(!V.value){d.value="이름을 입력해주세요.";return}u.value=!0,d.value=null,y.value=null;try{const a={name:f.value.name,phone:f.value.phone,subscription_type:f.value.subscription_type,subscription_status:f.value.subscription_status},c=await _.updateProfile(a);return y.value="프로필이 성공적으로 업데이트되었습니다.",c.data}catch(a){throw d.value=a.response?.data?.message||a.message||"프로필 업데이트에 실패했습니다.",a}finally{u.value=!1}}async function h(a){u.value=!0,d.value=null,y.value=null;try{const c=await _.uploadAvatar(a);return f.value.profile_image_url=c.data.profile.profile_image_url,y.value="아바타가 성공적으로 업로드되었습니다.",c.data}catch(c){throw d.value=c.response?.data?.message||c.message||"아바타 업로드에 실패했습니다.",c}finally{u.value=!1}}function A(a){f.value.profile_image_url=a}function s(){d.value=null,y.value=null}return{profileData:f,loading:u,error:d,success:y,isFormValid:V,fetchProfile:E,updateProfile:L,uploadAvatar:h,updateProfileImage:A,clearMessages:s}}),Ce={class:"profile-edit-container"},Ve={class:"profile-edit-wrapper"},Ee={class:"profile-header"},Ae={class:"profile-image-section"},Ie={class:"profile-image-wrapper"},De=["src"],He={key:0,class:"upload-progress-overlay"},Ue={class:"upload-progress"},Fe={class:"progress-bar"},Le={class:"progress-text"},Me={class:"form-section"},Re={class:"form-row"},Ge={class:"form-group"},ze=["value"],Be={class:"account-type"},$e={class:"form-group"},je={key:0,class:"field-error"},Ne={class:"form-section"},Oe={class:"form-group"},qe={class:"form-row"},Je={class:"form-group"},We={class:"form-group"},Ye={class:"form-group",style:{"text-align":"right","margin-top":"10px"}},Ke=["disabled"],Qe={class:"form-section verification-section"},Xe={class:"section-header"},Ze={key:0,class:"check-icon"},et={class:"form-row"},tt={class:"form-group"},st=["value","placeholder"],at={class:"form-group"},ot={key:0,class:"modal-overlay"},rt={class:"modal-content"},nt={class:"form-section payment-section"},lt={class:"section-header"},it={key:0,class:"check-icon"},ut={class:"form-row"},dt={class:"form-group"},ct=["value","placeholder"],pt={class:"form-group"},mt={key:1,class:"modal-overlay"},vt={class:"modal-content"},ft={class:"form-section"},_t={class:"subscription-container"},gt={class:"subscription-type"},yt={class:"subscription-status"},bt=["innerHTML"],ht=["onClick"],wt={key:0,class:"error-message"},Pt={key:1,class:"success-message"},kt={class:"form-actions"},St=["disabled"],xt={class:"delete-account"},Tt=me({__name:"ProfileEditView",setup(f){const u=he();q(()=>{console.log("ProfileEditView: 화면 진입, 사이드바 비활성화"),u.importState({leftSidebarHidden:!0,rightSidebarHidden:!0})});const d=T(()=>u.leftSidebarHidden),y=T(()=>u.rightSidebarHidden),V=()=>{console.log("ProfileEditView: handleToggleLeftSidebar 호출됨"),console.log("ProfileEditView: 좌측 사이드바 상태:",u.leftSidebarHidden)},E=()=>{console.log("ProfileEditView: handleToggleRightSidebar 호출됨"),console.log("ProfileEditView: 우측 사이드바 상태:",u.rightSidebarHidden)},L=async()=>{try{console.log("로그아웃 시작"),await Se().logout(),console.log("로그아웃 완료, 로그인 페이지로 이동"),h.push("/login")}catch(o){console.error("로그아웃 중 오류:",o),h.push("/login")}},h=be(),A=Te(),{profileData:s,loading:a,error:c,success:M,isFormValid:W}=ve(A),{fetchProfile:k,updateProfile:Ct,uploadAvatar:Y,updateProfileImage:Vt,clearMessages:B}=A,S=i(null),$=T(()=>S.value?s.value.name!==S.value.name||s.value.phone!==S.value.phone||s.value.subscription_type!==S.value.subscription_type:!1),g=i({}),K=T(()=>W.value&&Object.keys(g.value).length===0&&$.value),j=i(),x=i(null),w=i(0),R=i(!1),I=i(null),l=i({currentPassword:"",newPassword:"",confirmPassword:""}),Q=i([{type:"free",name:"Free",status:"현재 무료 체험 중",features:"- 등기 분석 5건/월<br>- 기본 계약서 미리보기<br>- AI 상담 3회 제공",buttonText:"요금제 변경"},{type:"standard",name:"Standard",status:"월 39,000원",features:"- 등기 분석 무제한<br>- 판례 검색 가능<br>- 계약서 생성 10건/월",buttonText:"변경하기"},{type:"pro",name:"Pro",status:"월 99,000원",features:"- 고급 등기 AI 분석<br>- 판례 유사도 기반 추천<br>- 계약서 작성 + 인쇄 지원<br>- 팀 공유 기능 포함",buttonText:"변경하기"},{type:"enterprise",name:"Enterprise",status:"문의 필요",features:"- 전자서명 연동<br>- API 연동 서비스<br>- 데이터 내재화 컨설팅 포함",buttonText:"문의하기"}]),X=T(()=>l.value.currentPassword&&l.value.newPassword&&l.value.confirmPassword&&l.value.newPassword===l.value.confirmPassword);q(async()=>{await k(),S.value={...s.value}});function Z(){return g.value={},(s.value.name??"").trim()?(s.value.name??"").trim().length<2&&(g.value.name="이름은 2자 이상 입력해주세요."):g.value.name="이름을 입력해주세요.",s.value.phone&&(/^01[0-9]-\d{3,4}-\d{4}$/.test(s.value.phone??"")||(g.value.phone="올바른 휴대폰 번호 형식을 입력해주세요. (예: 010-1234-5678)")),Object.keys(g.value).length===0}function N(){j.value?.click()}async function ee(o){const t=o.target,r=t.files?.[0];if(!r)return;console.log("[DEBUG] handleImageUpload 호출됨"),console.log("[DEBUG] 파일 정보:",{name:r.name,size:r.size,type:r.type});const G=te(r);if(G){I.value=G,setTimeout(()=>{I.value=null},3e3),t.value="";return}const O=new FileReader;O.onload=P=>{x.value=P.target?.result,console.log("avatarPreview set:",x.value)},O.readAsDataURL(r);try{R.value=!0,w.value=0,I.value=null;const P=setInterval(()=>{w.value<90&&(w.value+=10)},100);console.log("[DEBUG] uploadAvatar 함수 호출 전"),await Y(r),console.log("[DEBUG] uploadAvatar 함수 호출 완료"),clearInterval(P),w.value=100,await k(),x.value=null,setTimeout(()=>{B(),w.value=0},2e3)}catch(P){console.error("아바타 업로드 실패:",P),console.error("에러 응답:",P.response),I.value=P.response?.data?.message||"아바타 업로드에 실패했습니다.",x.value=null}finally{R.value=!1,t.value=""}}function te(o){return o.size>5242880?"파일 크기는 5MB 이하여야 합니다.":["image/jpeg","image/jpg","image/png","image/gif"].includes(o.type)?null:"JPG, PNG, GIF 형식의 이미지만 업로드 가능합니다."}async function se(){try{if(!Z())return;if(!$.value){alert("변경된 내용이 없습니다.");return}const o={name:s.value.name,phone:s.value.phone,subscription_type:s.value.subscription_type,subscription_status:s.value.subscription_status},t=await _.updateProfile(o);return S.value={...s.value},M.value="프로필이 성공적으로 업데이트되었습니다.",setTimeout(()=>{B()},3e3),t.data}catch(o){throw console.error("프로필 업데이트 실패:",o),c.value=o.response?.data?.message||"프로필 업데이트에 실패했습니다.",o}}async function ae(){try{const o=await _.changePassword({current_password:l.value.currentPassword,new_password:l.value.newPassword,confirm_password:l.value.confirmPassword});alert("비밀번호가 성공적으로 변경되었습니다."),l.value={currentPassword:"",newPassword:"",confirmPassword:""}}catch(o){console.error("비밀번호 변경 실패:",o),alert(o.response?.data?.message||"비밀번호 변경에 실패했습니다.")}}async function oe(o){try{if(o==="enterprise")h.push("/contact");else if(confirm(`${o} 요금제로 변경하시겠습니까?`)){const r=await _.updateSubscription({subscription_type:o,subscription_status:"active"});alert("구독이 성공적으로 변경되었습니다."),await k()}}catch(t){console.error("구독 변경 실패:",t),alert(t.response?.data?.message||"구독 변경에 실패했습니다.")}}async function re(){try{if(confirm("정말로 탈퇴하시겠습니까? 이 작업은 되돌릴 수 없습니다.")){const o=await _.deleteAccount();alert("회원 탈퇴가 완료되었습니다."),h.push("/login")}}catch(o){console.error("회원 탈퇴 실패:",o),alert(o.response?.data?.message||"회원 탈퇴에 실패했습니다.")}}function ne(){h.back()}function le(o){return{email:"이메일",google:"Google",kakao:"카카오",naver:"네이버"}[o]||"이메일"}function ie(o){return o?o.replace(/(\d{3})-(\d{3,4})-(\d{4})/,"****-****-$3"):"****-****-****"}const D=i(!1),H=i(!1);async function ue(){try{await _.updateProfile({is_phone_verified:!0,phone:"010-1234-5678"}),await k(),D.value=!1}catch{alert("본인 인증 처리 실패")}}async function de(){try{await _.updateProfile({payment_method_registered:!0,payment_card_number:"1234-****-****-5678",payment_card_type:"VISA",payment_card_expiry:"12/29"}),await k(),H.value=!1}catch{alert("결제 수단 등록 실패")}}async function ce(){if(confirm("정말로 프로필 이미지를 삭제하시겠습니까?"))try{await _.deleteAvatar(),await k(),x.value=null}catch{alert("프로필 이미지 삭제에 실패했습니다.")}}return(o,t)=>(v(),p("div",Ce,[z(we,{onToggleLeftSidebar:V,onToggleRightSidebar:E}),z(Pe,{isHidden:d.value},null,8,["isHidden"]),z(ke,{isHidden:y.value,onToggleSidebar:E,onLogout:L},null,8,["isHidden"]),e("div",{class:C(["main-content",{"sidebar-hidden":d.value}])},[e("div",Ve,[e("div",Ee,[e("div",Ae,[e("div",Ie,[e("img",{src:x.value||(n(s).profile_image_url??""?(n(s).profile_image_url??"").startsWith("/media/")?n(s).profile_image_url??"":n(s).profile_image_url??"":"/src/assets/sample_profile.jpg"),alt:"프로필 이미지",class:"profile-image",onClick:N},null,8,De),R.value?(v(),p("div",He,[e("div",Ue,[e("div",Fe,[e("div",{class:"progress-fill",style:fe({width:w.value+"%"})},null,4)]),e("span",Le,m(w.value)+"%",1)])])):b("",!0)]),e("label",{class:"image-upload-label",onClick:N,title:"프로필 사진 변경"},"📷"),e("button",{class:"image-delete-btn",onClick:ce,title:"프로필 사진 삭제"}," 🗑️ "),e("input",{ref_key:"imageInput",ref:j,type:"file",accept:"image/*",class:"image-upload-input",onChange:ee},null,544)])]),e("form",{onSubmit:J(se,["prevent"])},[e("div",Me,[t[11]||(t[11]=e("h2",{class:"form-section-title"},"기본 정보",-1)),e("div",Re,[e("div",Ge,[t[9]||(t[9]=e("label",{class:"form-label"},"아이디",-1)),e("input",{type:"text",class:"form-input",value:n(s).email,readonly:""},null,8,ze),e("div",Be,[t[8]||(t[8]=e("i",{class:"icon-email"},"📧",-1)),_e(" "+m(le(n(s).account_type))+" 계정 ",1)])]),e("div",$e,[t[10]||(t[10]=e("label",{class:"form-label"},"이름",-1)),U(e("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>n(s).name=r),type:"text",class:C(["form-input",{error:g.value.name}]),required:""},null,2),[[F,n(s).name]]),g.value.name?(v(),p("div",je,m(g.value.name),1)):b("",!0)])])]),e("div",Ne,[t[15]||(t[15]=e("h2",{class:"form-section-title"},"계정 보안",-1)),e("div",Oe,[t[12]||(t[12]=e("label",{class:"form-label"},"현재 비밀번호",-1)),U(e("input",{"onUpdate:modelValue":t[1]||(t[1]=r=>l.value.currentPassword=r),type:"password",class:"form-input",placeholder:"현재 비밀번호 입력"},null,512),[[F,l.value.currentPassword]])]),e("div",qe,[e("div",Je,[t[13]||(t[13]=e("label",{class:"form-label"},"새 비밀번호",-1)),U(e("input",{"onUpdate:modelValue":t[2]||(t[2]=r=>l.value.newPassword=r),type:"password",class:"form-input",placeholder:"새 비밀번호 입력"},null,512),[[F,l.value.newPassword]])]),e("div",We,[t[14]||(t[14]=e("label",{class:"form-label"},"새 비밀번호 확인",-1)),U(e("input",{"onUpdate:modelValue":t[3]||(t[3]=r=>l.value.confirmPassword=r),type:"password",class:"form-input",placeholder:"새 비밀번호 다시 입력"},null,512),[[F,l.value.confirmPassword]])])]),e("div",Ye,[e("button",{type:"button",class:"btn btn-secondary",onClick:ae,disabled:!X.value}," 비밀번호 변경하기 ",8,Ke)])]),e("div",Qe,[e("div",Xe,[t[16]||(t[16]=e("h2",{class:"form-section-title"},"본인 인증",-1)),e("div",{class:C(["verification-checkbox",{verified:n(s).is_phone_verified}])},[n(s).is_phone_verified?(v(),p("i",Ze,"✓")):b("",!0)],2)]),e("div",et,[e("div",tt,[t[17]||(t[17]=e("label",{class:"form-label"},"휴대폰 번호",-1)),e("input",{type:"text",class:"form-input",value:n(s).is_phone_verified?ie(n(s).phone??""):"",placeholder:n(s).is_phone_verified?"":"본인 인증을 완료해주세요",readonly:""},null,8,st)]),e("div",at,[t[18]||(t[18]=e("label",{class:"form-label",style:{opacity:"0"}},"본인 인증",-1)),e("button",{type:"button",class:"form-input verification-btn",onClick:t[4]||(t[4]=r=>D.value=!0)},m(n(s).is_phone_verified?"본인인증 다시 하기":"본인인증 하기"),1)])])]),D.value?(v(),p("div",ot,[e("div",rt,[t[19]||(t[19]=e("h3",null,"임시 본인 인증",-1)),t[20]||(t[20]=e("p",null,"임시로 본인 인증을 완료하시겠습니까?",-1)),e("button",{class:"btn btn-primary",onClick:ue}," 임시 본인 인증 완료 "),e("button",{class:"btn btn-secondary",onClick:t[5]||(t[5]=r=>D.value=!1)},"닫기")])])):b("",!0),e("div",nt,[e("div",lt,[t[21]||(t[21]=e("h2",{class:"form-section-title"},"결제 수단 정보",-1)),e("div",{class:C(["verification-checkbox",{verified:n(s).payment_method_registered}])},[n(s).payment_method_registered?(v(),p("i",it,"✓")):b("",!0)],2)]),e("div",ut,[e("div",dt,[t[22]||(t[22]=e("label",{class:"form-label"},"카드 번호",-1)),e("input",{type:"text",class:"form-input",value:n(s).payment_method_registered?n(s).payment_card_number:"",placeholder:n(s).payment_method_registered?"":"결제 수단을 등록해주세요",readonly:""},null,8,ct)]),e("div",pt,[t[23]||(t[23]=e("label",{class:"form-label",style:{opacity:"0"}},"결제 수단",-1)),e("button",{type:"button",class:"form-input payment-btn",onClick:t[6]||(t[6]=r=>H.value=!0)},m(n(s).payment_method_registered?"결제 수단 등록 다시하기":"결제 수단 등록하기"),1)])])]),H.value?(v(),p("div",mt,[e("div",vt,[t[24]||(t[24]=e("h3",null,"임시 결제 수단 등록",-1)),t[25]||(t[25]=e("p",null,"임시로 결제 수단을 등록하시겠습니까?",-1)),e("button",{class:"btn btn-primary",onClick:de}," 임시 결제 수단 등록 완료 "),e("button",{class:"btn btn-secondary",onClick:t[7]||(t[7]=r=>H.value=!1)},"닫기")])])):b("",!0),e("div",ft,[t[26]||(t[26]=e("h2",{class:"form-section-title"},"구독 정보",-1)),e("div",_t,[(v(!0),p(ge,null,ye(Q.value,r=>(v(),p("div",{key:r.type,class:C(["subscription-info",{active:n(s).subscription_type===r.type}])},[e("div",gt,m(r.name),1),e("div",yt,m(r.status),1),e("div",{class:"subscription-features",innerHTML:r.features},null,8,bt),e("button",{type:"button",class:"subscription-change",onClick:G=>oe(r.type)},m(r.buttonText),9,ht)],2))),128))]),n(c)?(v(),p("div",wt,m(n(c)),1)):b("",!0),n(M)?(v(),p("div",Pt,m(n(M)),1)):b("",!0),e("div",kt,[e("button",{type:"button",class:"btn btn-secondary",onClick:ne},"취소"),e("button",{type:"submit",class:"btn btn-primary",disabled:n(a)||!K.value},m(n(a)?"저장 중...":"저장"),9,St)])]),e("div",xt,[e("a",{href:"#",class:"delete-link",onClick:J(re,["prevent"])},"회원 탈퇴")])],32)])],2)]))}}),Dt=xe(Tt,[["__scopeId","data-v-1394f79f"]]);export{Dt as default};
