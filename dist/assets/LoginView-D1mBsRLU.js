import{d as S,l as m,x as V,t as o,F as q,G as D,z as r,m as u,r as v,o as I,v as k,y as P,C,M as L,q as p,k as B}from"./vue-Bso1jpR1.js";import{_ as $,b as G}from"./index-BEUJt7vQ.js";import"./utils-NIGUFBhG.js";const R={class:"modal-box"},T={key:0,class:"session-table"},U={key:1,class:"no-session"},E={class:"modal-actions"},j=S({__name:"SessionConflictModal",props:{onForceLogout:{type:Function},onCancel:{type:Function},sessions:{}},setup(h){function a(e){if(!e)return"";try{return new Date(e).toLocaleString("ko-KR",{hour12:!1})}catch{return e}}return(e,n)=>(u(),m("div",{class:"modal-backdrop",onClick:n[2]||(n[2]=V((...t)=>e.onCancel&&e.onCancel(...t),["self"]))},[o("div",R,[n[4]||(n[4]=o("div",{class:"modal-title"},"다른 웹 세션이 이미 로그인되어 있습니다",-1)),n[5]||(n[5]=o("div",{class:"modal-message"},[o("span",null,"기존 웹/모바일 세션 목록")],-1)),e.sessions&&e.sessions.length?(u(),m("table",T,[n[3]||(n[3]=o("thead",null,[o("tr",null,[o("th",null,"디바이스"),o("th",null,"IP"),o("th",null,"장비 정보"),o("th",null,"로그인 시간")])],-1)),o("tbody",null,[(u(!0),m(q,null,D(e.sessions,t=>(u(),m("tr",{key:t.session_id},[o("td",null,r(t.device_type),1),o("td",null,r(t.ip_address),1),o("td",null,r(t.user_agent),1),o("td",null,r(a(t.created_at)),1)]))),128))])])):(u(),m("div",U,"활성 세션 없음")),o("div",E,[o("button",{class:"modal-btn primary",onClick:n[0]||(n[0]=(...t)=>e.onForceLogout&&e.onForceLogout(...t))}," 기존 세션 로그아웃 후 로그인 "),o("button",{class:"modal-btn secondary",onClick:n[1]||(n[1]=(...t)=>e.onCancel&&e.onCancel(...t))},"로그인 취소")])])]))}}),z=$(j,[["__scopeId","data-v-85c00e9d"]]),K={class:"login-page-bg"},O={class:"login-container"},A={class:"input-group"},J={class:"input-group"},H=["disabled"],Q={key:0,class:"error-message"},W={class:"sns-login"},X={class:"sns-buttons"},Y={key:0,class:"dummy-login-floating"},Z=["disabled"],x=["disabled"],ss=["disabled"],os=S({__name:"LoginView",setup(h){const a=B(),e=G(),n=!1,t=[{email:"admin@gli.com",password:"admin123!",role:"admin",label:"관리자"},{email:"token@gli.com",password:"token123!",role:"token_manager",label:"토큰 매니저"},{email:"user@gli.com",password:"user123!",role:"user",label:"일반 사용자"}],g=v(""),b=v(""),c=v(!1),d=v(null),y=v([]),F=async l=>{l.preventDefault(),e.clearError();try{await e.login({email:g.value,password:b.value,device_type:"web"});const s=a.currentRoute.value.query.redirect;s?a.push(s):a.push("/")}catch(s){s.response?.data?.sessions&&(d.value={email:g.value,password:b.value,role:""},y.value=s.response.data.sessions,c.value=!0)}},w=l=>{console.log("SNS login:",l),alert(`${l} 로그인 기능은 준비 중입니다.`)},_=()=>{a.push("/signup")},f=async l=>{e.clearError();try{await e.login({email:l.email,password:l.password,device_type:"web"});const s=a.currentRoute.value.query.redirect;s?a.push(s):a.push("/")}catch(s){s.response?.data?.sessions&&(d.value=l,y.value=s.response.data.sessions,c.value=!0)}},M=async()=>{if(d.value)try{const l=await fetch("http://localhost:8000/api/auth/force-logout/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({device_type:"web",email:d.value.email})});if(!l.ok){const s=await l.json();alert("강제 로그아웃 실패: "+(s.error||"알 수 없는 오류")),c.value=!1,d.value=null;return}c.value=!1,await f(d.value),d.value=null}catch(l){console.error("Force logout error:",l),alert("강제 로그아웃 중 오류가 발생했습니다.")}},N=()=>{c.value=!1,d.value=null};return I(async()=>{await e.initialize()}),(l,s)=>(u(),m("div",K,[o("div",O,[s[15]||(s[15]=o("div",{class:"login-header"},[o("h1",{class:"login-title"},"GLI Platform"),o("p",{class:"login-subtitle"},"GLI 플랫폼에 오신 것을 환영합니다")],-1)),o("form",{class:"login-form",onSubmit:F},[o("div",A,[s[8]||(s[8]=o("label",{for:"email"},"이메일",-1)),C(o("input",{type:"email",id:"email","onUpdate:modelValue":s[0]||(s[0]=i=>g.value=i),required:""},null,512),[[L,g.value]])]),o("div",J,[s[9]||(s[9]=o("label",{for:"password"},"비밀번호",-1)),C(o("input",{type:"password",id:"password","onUpdate:modelValue":s[1]||(s[1]=i=>b.value=i),required:""},null,512),[[L,b.value]])]),o("button",{type:"submit",class:"login-button",disabled:p(e).isLoading},r(p(e).isLoading?"로그인 중...":"로그인"),9,H)],32),p(e).error?(u(),m("div",Q,r(p(e).error),1)):k("",!0),o("div",W,[s[13]||(s[13]=o("p",{class:"sns-title"},"SNS로 로그인하기",-1)),o("div",X,[o("button",{class:"sns-button",onClick:s[2]||(s[2]=i=>w("google"))},s[10]||(s[10]=[o("img",{src:"https://www.google.com/favicon.ico",alt:"Google"},null,-1)])),o("button",{class:"sns-button",onClick:s[3]||(s[3]=i=>w("kakao"))},s[11]||(s[11]=[o("img",{src:"https://www.kakaocorp.com/page/favicon.ico",alt:"Kakao"},null,-1)])),o("button",{class:"sns-button",onClick:s[4]||(s[4]=i=>w("naver"))},s[12]||(s[12]=[o("img",{src:"https://www.naver.com/favicon.ico",alt:"Naver"},null,-1)]))])]),o("div",{class:"signup-section"},[s[14]||(s[14]=o("p",{class:"signup-text"},"아직 계정이 없으신가요?",-1)),o("button",{class:"signup-button",onClick:_}," 회원가입 하기 ")])]),p(n)?(u(),m("div",Y,[s[16]||(s[16]=o("div",{class:"dummy-title"},"더미 계정 원클릭 로그인",-1)),o("button",{class:"dummy-btn",onClick:s[5]||(s[5]=i=>f(t[0])),disabled:p(e).isLoading}," 관리자 ("+r(t[0].email)+") ",9,Z),o("button",{class:"dummy-btn",onClick:s[6]||(s[6]=i=>f(t[1])),disabled:p(e).isLoading}," 토큰 매니저 ("+r(t[1].email)+") ",9,x),o("button",{class:"dummy-btn",onClick:s[7]||(s[7]=i=>f(t[2])),disabled:p(e).isLoading}," 일반 사용자 ("+r(t[2].email)+") ",9,ss)])):k("",!0),c.value?(u(),P(z,{key:1,sessions:y.value,onForceLogout:M,onCancel:N},null,8,["sessions"])):k("",!0)]))}}),ls=$(os,[["__scopeId","data-v-05e23dfd"]]);export{ls as default};
