import{d as L,k as p,O as V,p as o,F as q,H as D,v as m,l as d,r as v,o as M,t as B,q as y,A as k,L as C,u,z as E}from"./vue-B2oCC0D2.js";import{_ as S,b as I}from"./index-CwjfIGrk.js";import"./utils-NIGUFBhG.js";const P={class:"modal-box"},R={key:0,class:"session-table"},T={key:1,class:"no-session"},U={class:"modal-actions"},A=L({__name:"SessionConflictModal",props:{onForceLogout:{type:Function},onCancel:{type:Function},sessions:{}},setup($){function a(e){if(!e)return"";try{return new Date(e).toLocaleString("ko-KR",{hour12:!1})}catch{return e}}return(e,n)=>(d(),p("div",{class:"modal-backdrop",onClick:n[2]||(n[2]=V((...t)=>e.onCancel&&e.onCancel(...t),["self"]))},[o("div",P,[n[4]||(n[4]=o("div",{class:"modal-title"},"다른 웹 세션이 이미 로그인되어 있습니다",-1)),n[5]||(n[5]=o("div",{class:"modal-message"},[o("span",null,"기존 웹/모바일 세션 목록")],-1)),e.sessions&&e.sessions.length?(d(),p("table",R,[n[3]||(n[3]=o("thead",null,[o("tr",null,[o("th",null,"디바이스"),o("th",null,"IP"),o("th",null,"장비 정보"),o("th",null,"로그인 시간")])],-1)),o("tbody",null,[(d(!0),p(q,null,D(e.sessions,t=>(d(),p("tr",{key:t.session_id},[o("td",null,m(t.device_type),1),o("td",null,m(t.ip_address),1),o("td",null,m(t.user_agent),1),o("td",null,m(a(t.created_at)),1)]))),128))])])):(d(),p("div",T,"활성 세션 없음")),o("div",U,[o("button",{class:"modal-btn primary",onClick:n[0]||(n[0]=(...t)=>e.onForceLogout&&e.onForceLogout(...t))}," 기존 세션 로그아웃 후 로그인 "),o("button",{class:"modal-btn secondary",onClick:n[1]||(n[1]=(...t)=>e.onCancel&&e.onCancel(...t))},"로그인 취소")])])]))}}),O=S(A,[["__scopeId","data-v-85c00e9d"]]),j={class:"login-page-bg"},z={class:"login-container"},K={class:"input-group"},G={class:"input-group"},H=["disabled"],J={key:0,class:"error-message"},W={class:"sns-login"},Q={class:"sns-buttons"},X={class:"dummy-login-floating"},Y=["disabled"],Z=["disabled"],x=["disabled"],ss=L({__name:"LoginView",setup($){const a=E(),e=I(),n=[{email:"admin@lawide.com",password:"admin123!",role:"admin",label:"관리자"},{email:"agent@lawide.com",password:"agent123!",role:"agent",label:"중개인"},{email:"user1@lawide.com",password:"user123!",role:"user",label:"일반사용자1"}],t=v(""),g=v(""),c=v(!1),r=v(null),f=v([]),h=async l=>{l.preventDefault(),e.clearError();try{await e.login({email:t.value,password:g.value,device_type:"web"});const s=a.currentRoute.value.query.redirect;s?a.push(s):a.push("/")}catch(s){s.response?.data?.sessions&&(r.value={email:t.value,password:g.value,role:""},f.value=s.response.data.sessions,c.value=!0)}},w=l=>{console.log("SNS login:",l),alert(`${l} 로그인 기능은 준비 중입니다.`)},F=()=>{a.push("/signup")},b=async l=>{e.clearError();try{await e.login({email:l.email,password:l.password,device_type:"web"});const s=a.currentRoute.value.query.redirect;s?a.push(s):a.push("/")}catch(s){s.response?.data?.sessions&&(r.value=l,f.value=s.response.data.sessions,c.value=!0)}},_=async()=>{if(r.value)try{const l=await fetch("http://localhost:8000/api/auth/force-logout/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({device_type:"web",email:r.value.email})});if(!l.ok){const s=await l.json();alert("강제 로그아웃 실패: "+(s.error||"알 수 없는 오류")),c.value=!1,r.value=null;return}c.value=!1,await b(r.value),r.value=null}catch(l){console.error("Force logout error:",l),alert("강제 로그아웃 중 오류가 발생했습니다.")}},N=()=>{c.value=!1,r.value=null};return M(async()=>{await e.initialize()}),(l,s)=>(d(),p("div",j,[o("div",z,[s[15]||(s[15]=o("div",{class:"login-header"},[o("h1",{class:"login-title"},"LAWIDE"),o("p",{class:"login-subtitle"},"법률 도우미에 오신 것을 환영합니다")],-1)),o("form",{class:"login-form",onSubmit:h},[o("div",K,[s[8]||(s[8]=o("label",{for:"email"},"이메일",-1)),k(o("input",{type:"email",id:"email","onUpdate:modelValue":s[0]||(s[0]=i=>t.value=i),required:""},null,512),[[C,t.value]])]),o("div",G,[s[9]||(s[9]=o("label",{for:"password"},"비밀번호",-1)),k(o("input",{type:"password",id:"password","onUpdate:modelValue":s[1]||(s[1]=i=>g.value=i),required:""},null,512),[[C,g.value]])]),o("button",{type:"submit",class:"login-button",disabled:u(e).isLoading},m(u(e).isLoading?"로그인 중...":"로그인"),9,H)],32),u(e).error?(d(),p("div",J,m(u(e).error),1)):y("",!0),o("div",W,[s[13]||(s[13]=o("p",{class:"sns-title"},"SNS로 로그인하기",-1)),o("div",Q,[o("button",{class:"sns-button",onClick:s[2]||(s[2]=i=>w("google"))},s[10]||(s[10]=[o("img",{src:"https://www.google.com/favicon.ico",alt:"Google"},null,-1)])),o("button",{class:"sns-button",onClick:s[3]||(s[3]=i=>w("kakao"))},s[11]||(s[11]=[o("img",{src:"https://www.kakaocorp.com/page/favicon.ico",alt:"Kakao"},null,-1)])),o("button",{class:"sns-button",onClick:s[4]||(s[4]=i=>w("naver"))},s[12]||(s[12]=[o("img",{src:"https://www.naver.com/favicon.ico",alt:"Naver"},null,-1)]))])]),o("div",{class:"signup-section"},[s[14]||(s[14]=o("p",{class:"signup-text"},"아직 계정이 없으신가요?",-1)),o("button",{class:"signup-button",onClick:F},"회원가입 하기")])]),o("div",X,[s[16]||(s[16]=o("div",{class:"dummy-title"},"더미 계정 원클릭 로그인",-1)),o("button",{class:"dummy-btn",onClick:s[5]||(s[5]=i=>b(n[0])),disabled:u(e).isLoading}," 관리자 (admin@lawide.com) ",8,Y),o("button",{class:"dummy-btn",onClick:s[6]||(s[6]=i=>b(n[1])),disabled:u(e).isLoading}," 중개인 (agent@lawide.com) ",8,Z),o("button",{class:"dummy-btn",onClick:s[7]||(s[7]=i=>b(n[2])),disabled:u(e).isLoading}," 일반사용자1 (user1@lawide.com) ",8,x)]),c.value?(d(),B(O,{key:0,sessions:f.value,onForceLogout:_,onCancel:N},null,8,["sessions"])):y("",!0)]))}}),ts=S(ss,[["__scopeId","data-v-4a7aaff7"]]);export{ts as default};
